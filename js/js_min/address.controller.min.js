/*! yiqi_web 2016-12-30 */
!function(){"use strict";function a(a,b,c,d,e,f){function g(){var b={id:a.userInfo.id,username:a.userInfo.user_name};c.getUserAddressList(b).success(function(a){200!=a.ret?window.showAutoDialog(a.msg):2e4==a.data.code?p.addressArray=a.data.list:window.showAutoDialog(a.data.msg)})}function h(a,b,c){function d(){p.addAddressForm.address.city=""}function e(a){p[b]=a,c&&c()}f.getCityList(p.provinceArray,a,d,e)}function i(){if(!p.addAddressForm.address.province||!p.addAddressForm.address.city)return window.showAutoDialog("请先选择省份、城市地区"),!1;if(0==p.flag.addAddressFlag)return!1;var b={id:a.userInfo.id,username:a.userInfo.user_name,address:JSON.stringify(p.addAddressForm.address),zip:p.addAddressForm.zip.toString(),consignee:p.addAddressForm.consignee,mobile:p.addAddressForm.mobile};a.$broadcast("public.show",["loading_panel"]),p.flag.addAddressFlag=!1,c.addAddress(b).success(function(b){try{if(200!=b.ret)return window.showAutoDialog(b.msg),!1;2e4==b.data.code?(window.showAlertTip(b.data.msg),d.reload()):window.showAutoDialog(b.data.msg)}catch(a){}finally{a.$broadcast("public.hide",["loading_panel"]),p.flag.addAddressFlag=!0}})}function j(b){p.selectAddressId=b;var c={alertDialogTitle:"确定删除该收货地址吗？删除之后不可恢复，请谨慎操作！",alertDialogConfirm:p.deleteAddress,alertDialogCancel:null,alertDialogCancelButton:!0};a.$broadcast("public.showAlertDialog",c)}function k(){if(a.$broadcast("public.hide",[]),0==p.flag.deleteAddressFlag)return!1;var b={id:p.selectAddressId,username:a.userInfo.user_name};a.$broadcast("public.show",["loading_panel"]),p.flag.deleteAddressFlag=!1,c.deleteAddress(b).success(function(b){try{if(200!=b.ret)return window.showAutoDialog(b.msg),!1;2e4==b.data.code?(window.showAlertTip(b.data.msg),d.reload()):window.showAutoDialog(b.data.msg)}catch(a){}finally{a.$broadcast("public.hide",["loading_panel"]),p.flag.deleteAddressFlag=!0}})}function l(b){var e={id:b,username:a.userInfo.user_name};c.setDefaultAddress(e).success(function(a){return 200!=a.ret?(window.showAutoDialog(a.msg),!1):void(2e4==a.data.code?(window.showAlertTip(a.data.msg),d.reload()):window.showAutoDialog(a.data.msg))})}function m(a){p.edit_dialog_mask=!0,p.edit_dialog=!0,p.getCityList(a.province,"cityArray2",function(){p.editAddressForm={id:a.id,address:{province:a.province,city:a.city,location:a.address},zip:a.zip,consignee:a.consignee,mobile:a.mobile}})}function n(){if(!p.editAddressForm.address.province||!p.editAddressForm.address.city)return window.showAlertTip("请先选择省份、城市地区"),!1;if(0==p.flag.editAddressFlag)return!1;var b={id:p.editAddressForm.id,username:a.userInfo.user_name,address:JSON.stringify(p.editAddressForm.address),zip:p.editAddressForm.zip,consignee:p.editAddressForm.consignee,mobile:p.editAddressForm.mobile};a.$broadcast("public.show",["loading_panel"]),p.flag.editAddressFlag=!1,c.editAddress(b).success(function(b){try{if(200!=b.ret)return window.showAutoDialog(b.msg),!1;2e4==b.data.code?(window.showAlertTip(b.data.msg),d.reload()):window.showAutoDialog(b.data.msg)}catch(a){}finally{a.$broadcast("public.hide",["loading_panel"]),p.flag.editAddressFlag=!0}})}function o(){p.edit_dialog_mask=!1,p.edit_dialog=!1}a.title="帐户设置-收货地址";var p=this;p.edit_dialog_mask=!1,p.edit_dialog=!1,p.provinceArray=[],p.cityArray1=[],p.cityArray2=[],p.addAddressForm={address:{province:"",city:"",location:""},zip:"",consignee:"",mobile:""},p.editAddressForm={id:"",address:{province:"",city:"",location:""},zip:"",consignee:"",mobile:""},p.flag={addAddressFlag:!0,deleteAddressFlag:!0,editAddressFlag:!0},p.getAddressList=g,p.getCityList=h,p.addAddressSubmit=i,p.showDeleteDialog=j,p.deleteAddress=k,p.setDefaultAddress=l,p.showEditDialog=m,p.editAddressSubmit=n,p.editDialogCancel=o,function(){p.getAddressList(),f.getProvinceList(function(a){p.provinceArray=a})}()}app.import("/app/Tpl/web/js/service/service_min/public.service.min.js","public.service"),app.import("/app/Tpl/web/js/service/service_min/address.service.min.js","address.service"),app.addController("addressController",a),a.$inject=["$rootScope","publicService","personalService","$state","$timeout","addressService"]}();