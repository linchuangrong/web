/*! yiqi_web 2016-12-30 */
!function(){"use strict";function a(a,b,c,d,e,f){function g(){var b={user_id:a.userInfo.id,review_sn:e.review_sn,order_sn:e.order_sn};d.check(b).success(function(a){return 200!=a.ret?(window.showAutoDialog(a.msg),!1):void(60010==a.data.code||(window.showAutoDialog(a.data.msg),f.go("personal.home")))})}function h(a){E.projectNameArray.splice(a,1),0==E.projectNameArray.length&&(E.projectNameArray=[""])}function i(a){E.projectNameArray.splice(a+1,0,""),0==E.projectNameArray.length&&(E.projectNameArray=[""])}function j(a,b){var c={first_title:E.first_title,data:[{second_title:E.second_title,data:[{third_title:"",score:"",remark:""}]}]};E.designJson.splice(b+1,0,c),B(a)}function k(a){E.designJson.splice(a,1),window.showAlertTip("删除成功")}function l(a,b){E.designJson[b].editStatus=!E.designJson[b].editStatus,c(function(){angular.element(a.target).siblings("input").focus()},10)}function m(){var a=E.designJson.length;c(function(){angular.element("#add_"+a).click()},0)}function n(a,b,c){var d={second_title:E.second_title,data:[{third_title:"",score:"",remark:""}]};E.designJson[b].data.splice(c+1,0,d),B(a)}function o(a,b){E.designJson[a].data.splice(b,1),window.showAlertTip("删除成功")}function p(){var a=E.designJson.length,b=E.designJson[a-1].data.length;c(function(){angular.element("#add_"+a+"_"+b).click()},0)}function q(a,b,d){E.designJson[b].data[d].editStatus=!E.designJson[b].data[d].editStatus,c(function(){angular.element(a.target).siblings("input").focus()},10)}function r(a,b,c,d){var e={third_title:"",score:"",remark:""};E.designJson[b].data[c].data.splice(d+1,0,e),B(a)}function s(a,b,c){E.designJson[a].data[b].data.splice(c,1),window.showAlertTip("删除成功")}function t(){var a=E.designJson.length,b=E.designJson[a-1].data.length,d=E.designJson[a-1].data[b-1].data.length;c(function(){angular.element("#add_"+a+"_"+b+"_"+d).click()},0)}function u(a){if(0==a)return!1;var b=a-1;E.designJson[a]=E.designJson.splice(b,1,E.designJson[a])[0],window.showAlertTip("上移完成")}function v(a){if(a==E.designJson.length-1)return!1;var b=a+1;E.designJson[a]=E.designJson.splice(b,1,E.designJson[a])[0],window.showAlertTip("下移完成")}function w(a,b){if(0==b)return!1;var c=b-1;E.designJson[a].data[b]=E.designJson[a].data.splice(c,1,E.designJson[a].data[b])[0],window.showAlertTip("上移完成")}function x(a,b){if(b==E.designJson[a].data.length-1)return!1;var c=b+1;E.designJson[a].data[b]=E.designJson[a].data.splice(c,1,E.designJson[a].data[b])[0],window.showAlertTip("下移完成")}function y(a,b,c){if(0==c)return!1;var d=c-1;E.designJson[a].data[b].data[c]=E.designJson[a].data[b].data.splice(d,1,E.designJson[a].data[b].data[c])[0],window.showAlertTip("上移完成")}function z(a,b,c){if(c==E.designJson[a].data[b].data.length-1)return!1;var d=c+1;E.designJson[a].data[b].data[c]=E.designJson[a].data[b].data.splice(d,1,E.designJson[a].data[b].data[c])[0],window.showAlertTip("下移完成")}function A(a){var b=window.event?a.keyCode:a.which;13==b&&(a&&a.stopPropagation?(a.stopPropagation(),a.preventDefault()):(window.event.returnValue=!1,window.event.cancelBubble=!0),angular.element(a.target).blur())}function B(a){if(a){var b=angular.element(a.target).closest(".panel-box"),d=b.offset().top+b.outerHeight();c(function(){angular.element("html,body").animate({scrollTop:d-60},500)},100)}else c(function(){angular.element("html,body").scrollTop("99999")},100)}function C(){var b={alertDialogTitle:"确定提交吗？提交之后不可修改，请谨慎操作！",alertDialogConfirm:E.alertDialogConfirm,alertDialogCancel:null,alertDialogCancelButton:!0};a.$broadcast("public.showAlertDialog",b)}function D(){if(!E.flag.submitReviewFormFlag)return!1;a.$broadcast("public.hide",[]);for(var b=0;b<E.projectNameArray.length;b++)if(""==E.projectNameArray[b].trim()||!E.projectNameArray[b])return window.showAutoDialog("请将项目名称填写完整"),!1;if("addExamine1"==a.currentRouter)for(var c=0;c<E.designJson.length;c++)for(var g=E.designJson[c].data,h=0;h<g.length;h++)for(var i=g[h].data,j=0;j<i.length;j++){if(""==i[j].third_title.trim())return window.showAutoDialog("有一道题的<span class='color-red'>评分标准</span>没编辑，无法提交<br>题目序号："+(j+1)),!1;if(!i[j].score&&"0"!=i[j].score)return window.showAutoDialog("有一道题的<span class='color-red'>分值</span>没编辑，无法提交<br>题目序号："+(j+1)),!1}else if("addExamine2"==a.currentRouter)for(var c=0;c<E.designJson.length;c++)for(var g=E.designJson[c].data,h=0;h<g.length;h++){var i=g[h].data;if(g[h].second_title.indexOf("请点击")>-1)return window.showAutoDialog("请编辑标题<br>标题序号："+(h+1)),!1;for(var j=0;j<i.length;j++){if(""==i[j].third_title.trim())return window.showAutoDialog("有一道题的<span class='color-red'>指标标题</span>没编辑，无法提交<br>题目序号："+(h+1)+"."+(j+1)),!1;if(!i[j].score&&"0"!=i[j].score)return window.showAutoDialog("有一道题的<span class='color-red'>分值</span>没编辑，无法提交<br>题目序号："+(h+1)+"."+(j+1)),!1}}else if("addExamine3"==a.currentRouter)for(var c=0;c<E.designJson.length;c++){var g=E.designJson[c].data;if("0"==E.designJson[c].first_title.indexOf("请点击"))return window.showAutoDialog("请编辑大标题<br>标题序号："+(c+1)),!1;for(var h=0;h<g.length;h++){var i=g[h].data;if("0"==g[h].second_title.indexOf("请点击"))return window.showAutoDialog("请编辑评审科目标题<br>标题序号："+(c+1)+"."+(h+1)),!1;for(var j=0;j<i.length;j++){if(""==i[j].third_title.trim())return window.showAutoDialog("有一道题的<span class='color-red'>指标标题</span>没编辑，无法提交<br>题目序号："+(c+1)+"."+(h+1)+"."+(j+1)),!1;if(!i[j].score&&"0"!=i[j].score)return window.showAutoDialog("有一道题的<span class='color-red'>分值</span>没编辑，无法提交<br>题目序号："+(c+1)+"."+(h+1)+"."+(j+1)),!1}}}var k={user_id:a.userInfo.id,review_sn:e.review_sn,score_title:E.submitForm.score_title,project_number:E.submitForm.project_number,project_name:E.projectNameArray.join(","),review_title:E.submitForm.review_title,review_content:E.submitForm.review_content,review_from:JSON.stringify(E.designJson)};a.$broadcast("public.show",["loading_panel"]),E.flag.submitReviewFormFlag=!1,d.submitReviewForm(k).success(function(b){try{if(200!=b.ret)return window.showAutoDialog(b.msg),!1;2e4==b.data.code?(window.showAutoDialog(b.data.msg),"0"==e.type?f.go("personal.myReview"):f.go("personal.myEstimate")):window.showAutoDialog(b.data.msg)}catch(a){}finally{E.flag.submitReviewFormFlag=!0,a.$broadcast("public.hide",["loading_panel"])}})}angular.element(b).scrollTop(0),a.title="添加评审";var E=this;"0"==e.type?E.title="设计评审表单":"1"==e.type?E.title="设计评估表单":E.title="设计表单",E.projectNameArray=[""],E.submitForm={score_title:"",project_number:"",review_title:"",review_content:""},E.flag={submitReviewFormFlag:!0},"addExamine1"==a.currentRouter?(E.first_title="",E.second_title=""):"addExamine2"==a.currentRouter?(E.first_title="",E.second_title="请点击右侧“笔”按钮编辑一级指标名称"):"addExamine3"==a.currentRouter&&(E.first_title="请点击右侧“笔”按钮编辑大标题",E.second_title="请点击右侧“笔”按钮编辑评审科目标题"),E.designJson=[{first_title:E.first_title,data:[{second_title:E.second_title,data:[{third_title:"",score:"",remark:""}]}]}],E.check=g,E.deleteProjectName=h,E.addProjectName=i,E.addFirstObj=j,E.deleteFirstObj=k,E.editFirstObj=l,E.addLastFirstObj=m,E.moveTopFirst=u,E.moveBottomFirst=v,E.addSecondObj=n,E.deleteSecondObj=o,E.editSecondObj=q,E.addLastSecondObj=p,E.moveTopSecond=w,E.moveBottomSecond=x,E.addThirdObj=r,E.deleteThirdObj=s,E.addLastThirdObj=t,E.moveTopThird=y,E.moveBottomThird=z,E.keycode13=A,E.showAlertDialog=C,E.alertDialogConfirm=D,function(){return a.userInfo.id?void E.check():(window.showAutoDialog("访问出错"),f.go("index"),!1)}(),function(){var a=angular.element(".right-float-content"),b=angular.element(window),c=a.offset().top,d=a.offset().left-b.scrollLeft(),e=null;window.onscroll=function(){clearTimeout(e),e=setTimeout(function(){b.scrollTop()+60>c?a.attr("style","position:fixed;top:80px;right:auto;left:"+d+"px"):b.scrollTop()+60<=c&&a.attr("style","position:absolute;top:60px;right:0;left:auto")},10)},window.onresize=function(){"fixed"==a.css("position")&&a.attr("style","position:absolute;top:60px;right:0;left:auto"),d=a.offset().left-b.scrollLeft(),$(window).scroll()},angular.element(window).resize()}()}app.import("/app/Tpl/web/js/directive/contenteditable.directive.js","contenteditable.directive"),app.import("/app/Tpl/web/js/service/service_min/examine.service.min.js","examine.service"),app.addController("addExamineController",a),a.$inject=["$rootScope","$window","$timeout","examineService","$stateParams","$state"]}();