/*! yiqi_web 2016-12-30 */
!function(){"use strict";function a(a,b,c,d,e,f,g){function h(){var b={deal_id:d.crowdFundId,user_id:a.userInfo?a.userInfo.id:""};e.getUserFocusFlag(b).success(function(a){return 200!=a.ret?(window.showAutoDialog(a.msg),!1):void(2e4==a.data.code?A.focusFlag=1==a.data.status:window.showAutoDialog(a.data.msg))})}function i(){if(!a.userInfo.id)return window.showAutoDialog("请先登录"),!1;var b={deal_id:d.crowdFundId,user_id:a.userInfo.id,username:a.userInfo.user_name};e.focusCrowdFund(b).success(function(a){return 200!=a.ret?(window.showAutoDialog(a.msg),!1):void(2e4==a.data.code?(A.focusFlag=a.data.status,window.showAlertTip(a.data.msg),f.reload()):window.showAutoDialog(a.data.msg))})}function j(){var b={id:d.crowdFundId,username:a.userInfo.user_name?a.userInfo.user_name:""};e.detail(b).success(function(a){if(200!=a.ret)return window.showAutoDialog(a.msg),!1;if(2e4==a.data.code){A.crowdFundInfo=a.data.list[0],A.projectProgressArray=a.data.deal_log,function(){for(var a=0;a<A.projectProgressArray.length;a++)A.projectProgressArray[a].image&&(A.projectProgressArray[a].imgArray=A.projectProgressArray[a].image.split(","))}(),A.sponsorInfo=a.data.sponsor[0],A.repayArray=a.data.item,window._bd_share_config={common:{bdSnsKey:{tsina:"89d1afaf46168b260f0a8adee885f71d",tqq:"c4ea495e3ee3f424b0118f72de250fb4"},bdSign:"off",bdMini:"2",bdMiniList:!1,bdStyle:"0",bdSize:"24",bdText:A.crowdFundInfo.name,bdPic:A.crowdFundInfo.image,bdComment:A.crowdFundInfo.brief},share:{}},window._bd_share_main=null;var b="/static/api/js/share.js?v=89860593.js?cdnversion="+~(-new Date/36e5);$("body").append("<script defer async='true' src='"+b+"'></script>")}else window.showAutoDialog(a.data.msg)})}function k(a){A.activePanel=a}function l(a,b){A[a].splice(b,1)}function m(){if(!A.flag.addProjectProgressFlag)return!1;if(!A.projectProgressDesc)return window.showAlertTip("请先添加一些文字描述"),!1;var b={user_id:a.userInfo.id,deal_id:d.crowdFundId,username:a.userInfo.user_name,comment_data:A.projectProgressDesc,image:A.projectImgArray.join(",")};a.$broadcast("public.show",["loading_panel"]),A.flag.addProjectProgressFlag=!1,e.addProjectProgress(b).success(function(b){try{if(200!=b.ret)return window.showAutoDialog(b.msg),!1;2e4==b.data.code?(window.showAutoDialog(b.data.msg),f.reload()):window.showAutoDialog(b.data.msg)}catch(a){}finally{a.$broadcast("public.hide",["loading_panel"]),A.flag.addProjectProgressFlag=!0}})}function n(){var a={deal_id:d.crowdFundId,pageSize:A.commentPageParams.pageSize,current:A.commentPageParams.current};g.getCommentList(a).success(function(a){if(200!=a.ret)window.showAutoDialog(a.msg);else if(2e4==a.data.code){A.commentArray=a.data.list,A.commentPageParams.page_count=a.data.page_count,A.comment_count=a.data.comment_count;for(var b=[],c=0;c<A.commentArray.length;c++)b.push(A.commentArray[c].id);A.getReplyList(b)}else window.showAutoDialog(a.data.msg)})}function o(a){var b={pid:a.join(",")};g.getReplyList(b).success(function(b){if(200!=b.ret)window.showAutoDialog(b.msg);else if(2e4==b.data.code){for(var c=0;c<a.length;c++)A.commentArray[c].list=b.data.list[a[c]];console.log(A.commentArray)}else window.showAutoDialog(b.data.msg)})}function p(){return function(a){parseInt(a)>0&&parseInt(a)<=A.commentPageParams.page_count?(A.commentPageParams.current=parseInt(a),A.getCommentList(),angular.element(b).scrollTop(0)):console.log("输入非法")}}function q(a,b,d,e,f){A.pid=b,A.reply_user_id=d,A.reply_nickname=e,A.showReplyBoxIndex=-1,A.replyPlaceholderIndex=-1,A.showCommentBoxIndex==f?A.showCommentBoxIndex=-1:(A.showCommentBoxIndex=f,c(function(){angular.element(a.target).closest("li").find("li.answer-item:first").find("textarea").focus()},100))}function r(a,b,d,e,f,g){A.pid=b,A.reply_user_id=d,A.reply_nickname=e,A.showCommentBoxIndex=-1,A.showReplyBoxIndex==f&&A.replyPlaceholderIndex==g?(A.showReplyBoxIndex=-1,A.replyPlaceholderIndex=-1):(A.showReplyBoxIndex=f,A.replyPlaceholderIndex=g,A.replyPlaceholder="回复 "+e,c(function(){angular.element(a.target).closest("ul").find("li:last").find("textarea").focus()},0))}function s(){if(!A.flag.addCommentFlag)return!1;if(0==A.commentText.toString().trim().length)return!1;if(!a.userInfo.id)return window.showAutoDialog("请先登录"),!1;var b={deal_id:d.crowdFundId,user_id:a.userInfo.id,nickname:a.userInfo.nickname,content:A.commentText};a.$broadcast("public.show",["loading_panel"]),A.flag.addCommentFlag=!1,g.addComment(b).success(function(b){try{200!=b.ret?window.showAutoDialog(b.msg):2e4==b.data.code?(window.showAlertTip(b.data.msg),f.reload()):window.showAutoDialog(b.data.msg)}catch(a){}finally{a.$broadcast("public.hide",["loading_panel"]),A.flag.addCommentFlag=!0}})}function t(){if(!A.flag.addReplyFlag)return!1;if(0==A.replyText.toString().trim().length)return!1;if(!a.userInfo.id)return window.showAutoDialog("请先登录"),!1;var b={deal_id:d.crowdFundId,user_id:a.userInfo.id,nickname:a.userInfo.nickname,content:A.replyText,pid:A.pid,reply_user_id:A.reply_user_id,reply_nickname:A.reply_nickname};console.log(b),a.$broadcast("public.show",["loading_panel"]),A.flag.addReplyFlag=!1,g.addComment(b).success(function(b){try{200!=b.ret?window.showAutoDialog(b.msg):2e4==b.data.code?(window.showAlertTip(b.data.msg),f.reload()):window.showAutoDialog(b.data.msg)}catch(a){}finally{a.$broadcast("public.hide",["loading_panel"]),A.flag.addReplyFlag=!0}})}function u(){var a={deal_id:d.crowdFundId,pageSize:A.peoplePageParams.pageSize,current:A.peoplePageParams.current};e.getPeopleList(a).success(function(a){return 200!=a.ret?(window.showAutoDialog(a.msg),!1):void(2e4==a.data.code?(A.peopleArray=a.data.list,A.peopleCount=a.data.count_num,A.peoplePageParams.page_count=a.data.page_count):window.showAutoDialog(a.data.msg))})}function v(){return function(a){parseInt(a)>0&&parseInt(a)<=A.peoplePageParams.page_count?(A.peoplePageParams.current=parseInt(a),A.getPeopleList(),angular.element(b).scrollTop(0)):console.log("输入非法")}}function w(a){var b=angular.element(a.target);b.hasClass("width100")?b.removeClass("width100"):(angular.element("img[toggle].width100").removeClass("width100"),b.addClass("width100"))}function x(b){if(!a.userInfo.id)return f.go("login"),!1;if(+b>0){var c={deal_id:d.crowdFundId,user_id:a.userInfo.id,item_id:0,price:b,is_invoice:0,invoice_title:"",address_id:""};A.creatFreeOrder(c)}}function y(b){return 0!=A.flag.creatFreeOrderFlag&&(a.$broadcast("public.show",["loading_panel"]),A.flag.creatFreeOrderFlag=!1,void e.creatOrderSubmit(b).success(function(b){try{if(200!=b.ret)return window.showAutoDialog(b.msg),!1;2e4==b.data.code?f.go("payMoney",{id:b.data.list.requestNo,price:b.data.list.deal_price,num:"1",Project_type:"0",url:"personal.joinCrowdFund"}):window.showAutoDialog(b.data.msg)}catch(a){}finally{a.$broadcast("public.hide",["loading_panel"]),A.flag.creatFreeOrderFlag=!0}}))}function z(b,c){if(!a.userInfo.id)return f.go("login"),!1;var e={deal_id:d.crowdFundId,user_id:a.userInfo.id,item_id:b,price:c};f.go("crowdFundOrder",e)}angular.element(b).scrollTop(0),a.title="众筹详情";var A=this;A.activePanel="detail",A.focusFlag=!1,A.projectProgressArray=[],A.projectProgressDesc="",A.projectImgArray=[],A.commentPageParams={showPage:5,pageSize:8,current:1,page_count:1,pageChange:p},A.commentArray=[],A.comment_count=0,A.replyPlaceholder="",A.showCommentBoxIndex=-1,A.showReplyBoxIndex=-1,A.replyPlaceholderIndex=-1,A.commentText="",A.replyText="",A.flag={addProjectProgressFlag:!0,addCommentFlag:!0,addReplyFlag:!0,creatFreeOrderFlag:!0},A.sponsorInfo={},A.repayArray=[],A.peopleArray=[],A.peopleCount="0",A.peoplePageParams={showPage:5,pageSize:8,current:1,page_count:1,pageChange:v},A.freeMoney=1,A.getUserFocusFlag=h,A.focusCrowdFund=i,A.getCrowdFundDetail=j,A.setActivePanel=k,A.deleteImage=l,A.addProjectProgress=m,A.setCommentBox=q,A.setReplyBox=r,A.getCommentList=n,A.getReplyList=o,A.addComment=s,A.addReply=t,A.getPeopleList=u,A.toggleImageWidth=w,A.addFreeMoney=x,A.creatFreeOrder=y,A.goToOrderPage=z,function(){A.getCrowdFundDetail(),a.userInfo.id&&A.getUserFocusFlag(),A.getPeopleList(),A.getCommentList()}()}app.import("/app/Tpl/web/js/service/service_min/crowdFund.service.min.js","crowdFund.service"),app.import("/app/Tpl/web/js/service/service_min/comment.service.min.js","comment.service"),app.import("/app/Tpl/web/js/directive/pagebar.directive.js","pagebar.directive"),app.import("/app/Tpl/web/js/directive/imgUpload.directive.js","imgUpload.directive"),app.addController("crowdFundDetailController",a),a.$inject=["$rootScope","$window","$timeout","$stateParams","crowdFundService","$state","commentService"]}();