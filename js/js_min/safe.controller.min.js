/*! yiqi_web 2016-12-30 */
!function(){"use strict";function a(a,b,c,d){function e(a,b,c){var d=document.querySelector("#"+a),e=document.querySelector("#"+b),f=d.getContext("2d"),g=e.getContext("2d");if(f.lineWidth=10,f.strokeStyle="#ccc",f.beginPath(),f.arc(d.width/2,d.height/2,d.width/2-f.lineWidth/2,0,2*Math.PI,!1),f.closePath(),f.stroke(),c<0||c>100)throw new Error("percent must be between 0 and 100");g.lineWidth=10;var h,i=0;!function a(){h=setTimeout(a,10),g.clearRect(0,0,e.width,e.height),g.beginPath(),parseInt(i/360*100)>50?g.strokeStyle="#5cb85c":g.strokeStyle="#f60",g.arc(e.width/2,e.height/2,e.width/2-g.lineWidth/2,0,i*Math.PI/180,!1),i+=4;var b=parseInt(i/360*100);i>c/100*360&&(b=c,clearTimeout(h)),g.stroke(),g.closePath(),g.save(),g.beginPath(),g.rotate(90*Math.PI/180),g.font="48px Arial",b>50?g.fillStyle="#5cb85c":g.fillStyle="#f60";var d=b+"%";b<10?g.fillText(d,75,-90):b<100?g.fillText(d,70,-90):g.fillText(d,55,-90),g.closePath(),g.restore()}()}function f(){var b=20;return a.userInfo.mobile&&(b+=20),a.userInfo.email&&(b+=20),a.userInfo.paypassword&&(b+=20),2!=a.userInfo.identify_status&&2!=a.userInfo.is_investor||(b+=20),b}function g(b){return"set_pay_password"!=b||a.userInfo.mobile?(p.safe_mask_div=!0,void(p[b]=!0)):(window.showAutoDialog("请先绑定手机"),!1)}function h(a){p[a]=!1}function i(){for(var a=0;a<p.dialogArray.length;a++)p[p.dialogArray[a]]=!1}function j(){if(0==p.flag.passwordFlag)return!1;if(p.newLoginPassword1!=p.newLoginPassword2)return window.showAlertTip("两次密码不一致"),!1;var b={id:a.userInfo.id,username:a.userInfo.user_name,user_pwd:p.newLoginPassword1,old_pwd:p.oldLoginPassword};a.$broadcast("public.show",["loading_panel"]),p.flag.passwordFlag=!1,c.updatePassword(b).success(function(b){try{if(200!=b.ret)return window.showAlertTip(b.msg),!1;2e4==b.data.code?(window.showAlertTip(b.data.msg),d.reload()):window.showAlertTip(b.data.msg)}catch(a){}finally{a.$broadcast("public.hide",["loading_panel"]),p.flag.passwordFlag=!0}})}function k(){if(0==p.flag.phoneFlag)return!1;var b={id:a.userInfo.id,username:a.userInfo.user_name,mobile:p.setMobileForm.mobile,verify_coder:p.setMobileForm.verify_coder,by:"绑定手机"==p.mobileDialogTitle?1:0};a.$broadcast("public.show",["loading_panel"]),p.flag.phoneFlag=!1,c.updateMobile(b).success(function(b){try{if(200!=b.ret)return window.showAlertTip(b.msg),!1;2e4==b.data.code?(window.showAlertTip(b.data.msg),d.reload()):window.showAlertTip(b.data.msg)}catch(a){}finally{a.$broadcast("public.hide",["loading_panel"]),p.flag.phoneFlag=!0}})}function l(){if(0==p.flag.emailFlag)return!1;var b={id:a.userInfo.id,username:a.userInfo.user_name,email:p.setEmailForm.email,verify_coder:p.setEmailForm.verify_coder,by:"绑定邮箱"==p.emailDialogTitle?1:0};a.$broadcast("public.show",["loading_panel"]),p.flag.emailFlag=!1,c.updateEmail(b).success(function(b){try{if(200!=b.ret)return window.showAlertTip(b.msg),!1;2e4==b.data.code?(window.showAlertTip(b.data.msg),d.reload()):window.showAlertTip(b.data.msg)}catch(a){}finally{a.$broadcast("public.hide",["loading_panel"]),p.flag.emailFlag=!0}})}function m(){if(0==p.flag.payPasswordFlag)return!1;if(p.setPayPasswordForm.payPassword1!=p.setPayPasswordForm.payPassword2)return!1;var b={id:a.userInfo.id,username:a.userInfo.user_name,paypwd:p.setPayPasswordForm.payPassword1,mobile:p.setPayPasswordForm.mobile,verify_coder:p.setPayPasswordForm.verify_coder};a.$broadcast("public.show",["loading_panel"]),p.flag.payPasswordFlag=!1,c.updatePayPassword(b).success(function(b){try{if(200!=b.ret)return window.showAlertTip(b.msg),!1;2e4==b.data.code?(window.showAlertTip(b.data.msg),d.reload()):window.showAlertTip(b.data.msg)}catch(a){}finally{a.$broadcast("public.hide",["loading_panel"]),p.flag.payPasswordFlag=!0}})}function n(){if(0==p.flag.idCardFlag)return!1;if(!p.setIdCardForm.id_frontimg)return window.showAlertTip("请上传身份证正面照"),!1;if(!p.setIdCardForm.id_backimg)return window.showAlertTip("请上传身份证反面照"),!1;var b={id:a.userInfo.id,username:a.userInfo.user_name,real_name:p.setIdCardForm.real_name,id_number:p.setIdCardForm.id_number,mobile:p.setIdCardForm.mobile,id_frontimg:p.setIdCardForm.id_frontimg,id_backimg:p.setIdCardForm.id_backimg,verify_coder:p.setIdCardForm.verify_coder};a.$broadcast("public.show",["loading_panel"]),p.flag.idCardFlag=!1,c.setIdCard(b).success(function(b){try{if(200!=b.ret)return window.showAlertTip(b.msg),!1;2e4==b.data.code?(window.showAlertTip(b.data.msg),d.reload()):window.showAlertTip(b.data.msg)}catch(a){}finally{a.$broadcast("public.hide",["loading_panel"]),p.flag.idCardFlag=!0}})}function o(){if(0==p.flag.companyFlag)return!1;if(!p.setCompanyForm.licence_img)return window.showAlertTip("请上传组织机构代码证（营业执照）"),!1;if(!p.setCompanyForm.cat_id)return window.showAlertTip("请选择行业"),!1;var b={id:a.userInfo.id,username:a.userInfo.user_name,bs_name:p.setCompanyForm.bs_name,bs_licence:p.setCompanyForm.bs_licence,licence_img:p.setCompanyForm.licence_img,cat_id:p.setCompanyForm.cat_id,bs_address:p.setCompanyForm.bs_address,bs_user:p.setCompanyForm.bs_user,verify_coder:p.setCompanyForm.verify_coder};a.$broadcast("public.show",["loading_panel"]),p.flag.companyFlag=!1,c.setCompany(b).success(function(b){try{if(200!=b.ret)return window.showAlertTip(b.msg),!1;2e4==b.data.code?(window.showAlertTip(b.data.msg),d.reload()):window.showAlertTip(b.data.msg)}catch(a){}finally{a.$broadcast("public.hide",["loading_panel"]),p.flag.companyFlag=!0}})}a.title="安全中心";var p=this;p.safe_mask_div=!1,p.set_phone=!1,p.set_password=!1,p.set_email=!1,p.set_pay_password=!1,p.set_idCard=!1,p.set_company=!1,p.dialogArray=["safe_mask_div","set_password","set_phone","set_email","set_pay_password","set_idCard","set_company"],p.mobileDialogTitle="绑定手机",p.emailDialogTitle="绑定邮箱",p.setMobileForm={mobile:"",verify_coder:""},p.setEmailForm={email:"",verify_coder:""},p.setPayPasswordForm={payPassword1:"",pasPassword2:"",mobile:"",verify_coder:""},p.setIdCardForm={real_name:"",id_number:"",mobile:"",id_frontimg:"",id_backimg:"",verify_coder:""},p.setCompanyForm={bs_name:"",bs_licence:"",licence_img:"",cat_id:"",bs_address:"",bs_user:"",verify_coder:""},p.flag={passwordFlag:!0,phoneFlag:!0,emailFlag:!0,payPasswordFlag:!0,idCardFlag:!0,companyFlag:!0},p.companyInfo={},p.idCardInfo={},p.getGrade=f,p.drawCircle=e,p.showDialog=g,p.closeDialog=h,p.closeAllDialog=i,p.phoneConfirm=k,p.passwordConfirm=j,p.emailConfirm=l,p.payPasswordConfirm=m,p.idCardConfirm=n,p.companyConfirm=o,p.drawCircle("canvas_1","canvas_2",p.getGrade()),function(){var b={id:a.userInfo.id,username:a.userInfo.user_name};c.getUserRealCenter(b).success(function(a){200!=a.ret?window.showAutoDialog(a.msg):2e4==a.data.code?(p.companyInfo=a.data.company,p.idCardInfo=a.data.personal):window.showAutoDialog(a.data.msg)})}()}app.import("/app/Tpl/web/js/directive/imgUpload.directive.js","imgUpload.directive"),app.addController("safeController",a),a.$inject=["$rootScope","$timeout","personalService","$state"]}();