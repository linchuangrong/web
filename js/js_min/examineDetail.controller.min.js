/*! yiqi_web 2016-12-30 */
!function(){"use strict";function a(a,b,c,d,e){function f(a){l.showPanel=a,angular.element(b).scrollTop(0)}function g(){var b={user_id:a.userInfo.id,review_sn:c.review_sn};d.getReviewDetail(b).success(function(b){if(200!=b.ret)return window.showAutoDialog(b.msg),!1;if(2e4==b.data.code)if(b.data.list){if(l.reviewInfo=b.data.list,"1"!=a.userInfo.identity_conditions&&l.reviewInfo.user_id!=a.userInfo.id)return window.showAutoDialog("无访问权限"),e.go("index"),!1;l.designJson=JSON.parse(b.data.list.review_from.toString()),l.getProjectArray()}else window.showAutoDialog("访问出错，可能表单未设置"),e.go("index");else window.showAutoDialog(b.data.msg),e.go("index")})}function h(){var b={user_id:a.userInfo.id,review_id:l.reviewInfo.id};d.getProjectArray(b).success(function(a){if(200!=a.ret)return window.showAutoDialog(a.msg),!1;if(2e4==a.data.code){l.projectArray=a.data.list;for(var b=0,c=0;c<l.projectArray.length;c++){if("0"==l.projectArray[c].status){l.activeProject=l.projectArray[c],c>=1&&(l.showPanel="2");break}b++}b==l.projectArray.length&&e.go("finalScore",{review_id:l.reviewInfo.id})}else"40003"==a.data.code?(window.showAutoDialog(a.data.msg),e.go("index")):window.showAutoDialog(a.data.msg)})}function i(a){for(var b=[],c=0;c<=a;c++)b.push(c);return b}function j(b){var c={alertDialogTitle:"提交后不可重新修改评分，确定提交对该项目的评分吗？",alertDialogConfirm:l.alertDialogConfirm,alertDialogCancel:null,alertDialogCancelButton:!0};a.$broadcast("public.showAlertDialog",c)}function k(){if(l.reviewInfo.user_id==a.userInfo.id)return window.showAlertTip("发起者不可评分"),!1;if(!l.flag.submitFlag)return!1;a.$broadcast("public.hide",[]);for(var b=0;b<l.designJson.length;b++)for(var f=l.designJson[b].data,g=0;g<f.length;g++)for(var h=f[g].data,i=0;i<h.length;i++){if(!h[i].valid_points&&"0"!=h[i].valid_points)return"1"==c.review_template?window.showAutoDialog("有一道题的<span class='color-red'>分值</span>没编辑，无法提交<br>题目序号："+(i+1)):"2"==c.review_template?window.showAutoDialog("有一道题的<span class='color-red'>分值</span>没编辑，无法提交<br>题目序号："+(g+1)+"."+(i+1)):"3"==c.review_template&&window.showAutoDialog("有一道题的<span class='color-red'>分值</span>没编辑，无法提交<br>题目序号："+(b+1)+"."+(g+1)+"."+(i+1)),!1;if(h[i].valid_points>h[i].score)return window.showAutoDialog("分值超过最高分，无法提交<br>题目序号："+(i+1)),!1}var j={user_id:a.userInfo.id,review_id:l.reviewInfo.id,project_id:l.activeProject.id,review_data:JSON.stringify(l.designJson)};a.$broadcast("public.show",["loading_panel"]),l.flag.submitFlag=!1,d.submitScore(j).success(function(b){try{200!=b.ret?window.showAutoDialog(b.msg):2e4==b.data.code?(window.showAlertTip(b.data.msg),e.reload()):window.showAutoDialog(b.data.msg)}catch(a){}finally{a.$broadcast("public.hide",["loading_panel"]),l.flag.submitFlag=!0}})}angular.element(b).scrollTop(0),a.title="项目评审";var l=this;"0"==c.type?l.title="评审":"1"==c.type&&(l.title="评估"),l.showPanel="1",l.reviewInfo={},l.designJson=[],l.review_template=c.review_template,l.flag={submitFlag:!0},l.activeProject={},l.setPanel=f,l.getReviewDetail=g,l.getProjectArray=h,l.getArray=i,l.showAlertDialog=j,l.alertDialogConfirm=k,function(){return a.userInfo.id?void l.getReviewDetail():(e.go("login"),!1)}()}app.import("/app/Tpl/web/js/directive/mouseover.directive.js","ngMouseOver.directive"),app.import("/app/Tpl/web/js/service/service_min/examine.service.min.js","examine.service"),app.addController("examineDetailController",a),a.$inject=["$rootScope","$window","$stateParams","examineService","$state"]}();