/*! yiqi_web 2016-12-30 */
!function(){"use strict";function a(a,b,c,d){function e(a){m.showPanner=a,m.setImgCodeSrc()}function f(a){var b=/^(1[0-9]{10})$/;return b.test(a)}function g(a){var b=/^((\w)+(\.\w+)*@(\w)+((\.\w+)+))$/;return b.test(a)}function h(){m.imgCodeSrc=d.getImgCode()}function i(){m.loginButtonDisabled=!0;var b={username:m.loginName,user_pwd:m.loginPassword,image_coder:m.loginImgCode};d.login(b).success(function(b){try{if("200"!=b.ret)return window.showAutoDialog(b.msg),!1;var d=b.data;2e4==d.code?(sessionStorage.removeItem("yiqi_loginError"),1==m.remember?localStorage.setItem("yiqi_user",m.loginName):localStorage.removeItem("yiqi_user"),$.cookie("yiqi_userInfo",JSON.stringify(d.info)),a.userInfo=d.info,a.fromState.name&&"findpassword"!=a.fromState.name?c.go(a.fromState.name,a.fromParams):c.go("index")):(window.showAutoDialog(d.msg),m.loginError++,sessionStorage.setItem("yiqi_loginError",m.loginError),m.loginError>=3&&(m.showLoginImgCode=!0))}catch(a){}finally{m.loginButtonDisabled=!1}})}function j(){if(!m.flag.registerFlag)return!1;if(!m.registerAgree)return!1;if("3"==m.conditions){if(m.registerName=m.registerName1,!m.isMobile(m.registerName))return window.showAlertTip("手机格式不正确"),!1}else if(m.registerName=m.registerName2,!m.isEmail(m.registerName))return window.showAlertTip("邮箱格式不正确"),!1;if(!m.registerCode)return window.showAlertTip("请输入手机验证码或邮箱验证码"),!1;if(m.registerPassword1!=m.registerPassword2)return window.showAlertTip("两次输入的密码不一致"),!1;if(!l(m.registerPassword1))return window.showAlertTip("密码格式不正确"),!1;if(!m.registerImgCode)return window.showAlertTip("请输入图片验证码"),!1;var a={conditions:m.conditions,username:m.registerName,user_pwd:m.registerPassword1,verify_coder:m.registerCode,is_agree:1,image_coder:m.registerImgCode};m.flag.registerFlag=!1,d.register(a).success(function(a){try{if(200!=a.ret)return window.showAutoDialog(a.msg),!1;2e4==a.data.code?(window.showAutoDialog(a.data.msg),m.setPanner("loginPanner"),m.registerName="",m.registerCode="",m.registerPassword1="",m.registerPassword2="",m.registerImgCode=""):window.showAutoDialog(a.data.msg)}catch(a){}finally{m.flag.registerFlag=!0}})}function k(){d.weixinLogin().success(function(a){return 200!=a.ret?(window.showAutoDialog(a.msg),!1):void(2e4==a.data.code?window.location.href=a.data.url:window.showAutoDialog(a.data.msg))})}function l(a){var b=a.toString().trim();if(b.length>18||b.length<6)return!1;var c=/^([a-zA-Z0-9_!@#%&-]|[\.\*\+]){0,}$/;return c.test(b)}a.title="登录/注册";var m=this;m.showPanner="loginPanner",m.imgCodeSrc=d.getImgCode(),m.loginName=localStorage.getItem("yiqi_user")||"",m.loginPassword="",m.loginImgCode="",m.remember=!0,m.loginError=sessionStorage.getItem("yiqi_loginError")||0,m.showLoginImgCode=m.loginError>=3,m.conditions="3",m.registerName="",m.registerCode="",m.registerPassword1="",m.registerPassword2="",m.registerImgCode="",m.flag={registerFlag:!0},m.registerAgree=!0,m.setImgCodeSrc=h,m.setPanner=e,m.login=i,m.register=j,m.isMobile=f,m.isEmail=g,m.weixinLogin=k}app.import("/app/Tpl/web/js/service/service_min/login.service.min.js","login.service"),app.addController("loginController",a),a.$inject=["$rootScope","$timeout","$state","loginService"]}();